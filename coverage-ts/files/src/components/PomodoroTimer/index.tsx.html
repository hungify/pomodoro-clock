
  <!DOCTYPE html>
  <html>
    <head>
      <title>index.tsx</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="..\..\..\..\assets\source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="..\..\..\..\assets\source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="..\..\..\..\index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">src\components\PomodoroTimer\index.tsx</td><td class="">100.00%</td><td class="">80%</td><td class="">283</td><td class="">283</td><td class="">0</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import React, { useEffect, useRef, useState } from &quot;react&quot;;
import { initialState, sounds, TimeType } from &quot;../../constants&quot;;
import Break from &quot;../Break&quot;;
import ControlPanel from &quot;../ControlPanel&quot;;
import Session from &quot;../Session&quot;;
import Timer from &quot;../Timer&quot;;
import useSound from &quot;use-sound&quot;;
import &quot;./style.scss&quot;;
const { initTimeLeft, initSessionLength, initBreakLength, initRingTime } = initialState;

let TIMEOUT: NodeJS.Timeout;

function PomodoroTimer() {
  const [timeLeft, setTimeLeft] = useState&lt;number&gt;(initTimeLeft);
  const [timeType, setTimeType] = useState&lt;TimeType&gt;(TimeType.SESSION);
  const [sessionLength, setSessionLength] = useState&lt;number&gt;(initSessionLength);
  const [ringTime, setRingTime] = useState&lt;number&gt;(initRingTime);
  const [breakLength, setBreakLength] = useState&lt;number&gt;(initBreakLength);
  const [started, setStarted] = useState&lt;boolean&gt;(false);
  const [intervalId, setIntervalId] = useState&lt;number&gt;();
  const [ringProgressPercentage, setRingProgressPercentage] = useState&lt;number&gt;(1);
  const [ringIntervalId, setRingIntervalId] = useState&lt;number&gt;();

  const myAudio = useRef&lt;HTMLAudioElement&gt;() as React.MutableRefObject&lt;HTMLAudioElement&gt;;
  const context = new AudioContext();

  const [soundPress, stopSoundPress] = useSound(sounds.press);
  const [soundClick, stopSoundClick] = useSound(sounds.click);
  const [soundTicking, stopSoundTicking] = useSound(sounds.ticking);

  const handleSwitch = () =&gt; {
    if (timeType === TimeType.SESSION) {
      setTimeType(TimeType.BREAK);
      setRingTime(breakLength * 60);
      setTimeLeft(breakLength * 60);
    } else if (timeType === TimeType.BREAK) {
      setTimeType(TimeType.SESSION);
      setRingTime(sessionLength * 60);
      setTimeLeft(sessionLength * 60);
    }
  };

  useEffect(() =&gt; {
    if (started &amp;&amp; timeLeft &gt;= 0) {
      setRingIntervalId(window.setInterval(() =&gt; ringProgress(timeLeft, ringTime), 1000));
      setIntervalId(
        window.setInterval(() =&gt; {
          setTimeLeft(() =&gt; {
            if (timeLeft &lt;= 10) {
              soundTicking();
            } else {
              stopSoundTicking.stop();
            }
            return timeLeft - 1;
          });
        }, 1000)
      );
    } else if (started &amp;&amp; timeLeft === -1) {
      handleSwitch();
      myAudio.current.play();
    } else {
      window.clearInterval(intervalId);
      window.clearInterval(ringIntervalId);
    }
    return () =&gt; {
      window.clearInterval(intervalId);
      window.clearInterval(ringIntervalId);
    };
  }, [started, timeLeft]);

  const ringProgress = (timeLeft: number, ringTime: number) =&gt; {
    setRingProgressPercentage(timeLeft / ringTime);
  };

  const handleOnStop = () =&gt; {
    if (started) setStarted(false);
  };

  const handleOnStart = () =&gt; {
    soundPress();
    const id = setTimeout(() =&gt; {
      stopSoundPress.stop();
    }, 1000);
    clearTimeout(id);
    setStarted(true);
    context.resume();
  };

  const handleOnReset = () =&gt; {
    if (started) {
      soundPress();
      const id = setTimeout(() =&gt; {
        stopSoundPress.stop();
      }, 1000);
      clearTimeout(id);

      setSessionLength(initSessionLength);
      setBreakLength(initBreakLength);
      setTimeLeft(initTimeLeft);

      setRingTime(initRingTime);
      setRingProgressPercentage(1);
      setTimeType(TimeType.SESSION);
      setStarted(false);

      myAudio.current.pause();
      myAudio.current.currentTime = 0;
    }
  };

  const incrementSession = () =&gt; {
    if (!started) {
      soundClick();
      const id = setTimeout(() =&gt; {
        stopSoundClick.stop();
      }, 1000);
      clearTimeout(id);

      setSessionLength(sessionLength + 1);
      setTimeLeft((sessionLength + 1) * 60);
      setRingTime((sessionLength + 1) * 60);
    }
  };

  const decrementSession = () =&gt; {
    if (!started &amp;&amp; sessionLength &gt; 1) {
      soundClick();
      const id = setTimeout(() =&gt; {
        stopSoundClick.stop();
      }, 1000);
      clearTimeout(id);

      setSessionLength(sessionLength - 1);
      setTimeLeft((sessionLength - 1) * 60);
      setRingTime((sessionLength - 1) * 60);
    }
  };

  const incrementBreak = () =&gt; {
    if (!started) {
      soundClick();

      const id = setTimeout(() =&gt; {
        stopSoundClick.stop();
      }, 1000);
      clearTimeout(id);
      setBreakLength(breakLength + 1);
    }
  };

  const decrementBreak = () =&gt; {
    if (!started &amp;&amp; breakLength &gt; 1) {
      soundClick();
      const id = setTimeout(() =&gt; {
        // soundClick.stop();
      }, 1000);
      clearTimeout(id);
      setBreakLength(breakLength - 1);
    }
  };

  return (
    &lt;div className=&quot;pomodoro&quot;&gt;
      &lt;Timer
        timeType={timeType}
        timeLeft={timeLeft}
        ringProgress={ringProgressPercentage}
      /&gt;
      &lt;ControlPanel
        started={started}
        onStop={handleOnStop}
        onStart={handleOnStart}
        onReset={handleOnReset}
      /&gt;
      &lt;div className=&quot;pomodoro__label&quot;&gt;
        &lt;Session
          sessionLength={sessionLength}
          incrementSession={incrementSession}
          decrementSession={decrementSession}
          started={started}
        /&gt;
        &lt;Break
          breakLength={breakLength}
          incrementBreak={incrementBreak}
          decrementBreak={decrementBreak}
          started={started}
        /&gt;
      &lt;/div&gt;

      &lt;audio
        ref={myAudio}
        className=&quot;audio&quot;
        src=&quot;https://pomofocus.io/audios/alarms/alarm-bell.mp3&quot;
      /&gt;
    &lt;/div&gt;
  );
}

export default PomodoroTimer;
</textarea><pre id="annotations" style="display:none">[]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Sat, 20 Nov 2021 15:22:34 GMT</p>
    </body>
  </html>
  